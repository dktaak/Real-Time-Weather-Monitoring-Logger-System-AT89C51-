C51 COMPILER V9.60.0.0   KEYBOARD_DRIVER                                                   04/08/2021 19:05:17 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEYBOARD_DRIVER
OBJECT MODULE PLACED IN .\Objects\keyboard_driver.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE keyboard_driver.c OPTIMIZE(8,SPEED) BROWSE PRINT(.\Listings\keyboard_dri
                    -ver.lst) TABS(2) OBJECT(.\Objects\keyboard_driver.obj)

line level    source

   1          #include"header.h"
   2          extern void delay(unsigned short int ms);
   3          sbit R0=P1^0;
   4          sbit R1=P1^1;
   5          sbit R2=P1^2;
   6          sbit R3=P1^3;
   7          sbit C0=P1^4;
   8          sbit C1=P1^5;
   9          sbit C2=P1^6;
  10          sbit C3=P1^7;
  11          u8 row=0,col=0;
  12          code key[4][4]={7,8,9,'/',4,5,6,'*',1,2,3,'-','#',0,'=','+'};
  13          
  14             u8 keyscan(void){
  15   1           
  16   1           R0=R1=R2=R3=0;
  17   1           C0=C1=C2=C3=1;
  18   1      while((C0&C1&C2&C3)==1);//waiting for key to press
  19   1        delay(30);//to avoid key bouncing
  20   1           
  21   1        /*row 0 chked*/
  22   1        R0=0;R1=R2=R3=1;
  23   1        if((C0&C1&C2&C3)==0){
  24   2          row=0;
  25   2          goto colcheck;
  26   2        }
  27   1          /*row 1 chked*/
  28   1        R1=0;R0=R2=R3=1;
  29   1        if((C0&C1&C2&C3)==0){
  30   2          row=1;
  31   2          goto colcheck;
  32   2        }
  33   1          /*row 2 chked*/
  34   1        R2=0;R0=R1=R3=1;
  35   1        if((C0&C1&C2&C3)==0){
  36   2          row=2;
  37   2          goto colcheck;
  38   2        }
  39   1            /*row 3 chked*/
  40   1        R3=0;R0=R1=R2=1;
  41   1        if((C0&C1&C2&C3)==0){
  42   2          row=3;
  43   2          goto colcheck;
  44   2        }
  45   1        colcheck:
  46   1          if(C0==0)
  47   1            col=0;
  48   1          else if(C1==0)
  49   1            col=1;
  50   1          else if(C2==0)
  51   1            col=2;
  52   1          else if(C3==0)
  53   1            col=3;
  54   1        while((C0&C1&C2&C3)==0);//waiting for key to release
C51 COMPILER V9.60.0.0   KEYBOARD_DRIVER                                                   04/08/2021 19:05:17 PAGE 2   

  55   1        return (key[row][col]); 
  56   1      }
  57             
  58          u8 math(void){
  59   1        u8 a[4],i;
  60   1        for(i=0;i<4;i++){
  61   2          a[i]=keyscan();
  62   2        if((a[i]>=0)&&(a[i]<=9))
  63   2          lcd_data(a[i]+48);
  64   2        else
  65   2          lcd_data(a[i]);
  66   2        if(a[i]==('='))
  67   2          break;
  68   2        else if(a[i]==('#')){
  69   3          lcd_cmd(0x1);
  70   3          return 0;
  71   3        } 
  72   2      }
  73   1        switch(a[1]){
  74   2          case '/':
  75   2            a[0]=(a[0]/a[2]);break;
  76   2          case '*':
  77   2            a[0]=(a[0]*a[2]);break;
  78   2          case '+':
  79   2            a[0]=(a[0]+a[2]);break;
  80   2          case '-':
  81   2            a[0]=(a[0]-a[2]);break;
  82   2        } 
  83   1        return a[0];
  84   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    343    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
